# Enhanced PhimGG Cron Job Configuration
# Optimized for better content discovery and import success
# Copy this to /etc/cron.d/filmflex-imports

# Environment variables for cron jobs
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
SHELL=/bin/bash

# 1. Enhanced regular imports - Weekday mornings and evenings (smart scanning)
0 6,18 * * 1-5 root /root/Film_Flex_Release/scripts/deployment/enhanced-cron-wrapper.sh regular >/dev/null 2>&1

# 2. Weekend enhanced imports - Saturday and Sunday with deep discovery
0 10 * * 6,0 root /root/Film_Flex_Release/scripts/deployment/enhanced-cron-wrapper.sh weekend >/dev/null 2>&1

# 3. Deep discovery scan - Saturday early morning (comprehensive scanning)
0 4 * * 6 root /root/Film_Flex_Release/scripts/deployment/enhanced-cron-wrapper.sh deep >/dev/null 2>&1

# 4. Weekly comprehensive scan - First Sunday of month (full database refresh)
0 1 1-7 * 0 root /root/Film_Flex_Release/scripts/deployment/enhanced-cron-wrapper.sh comprehensive force >/dev/null 2>&1

# 5. Alternative content discovery - Mid-week targeted scan for new content
0 14 * * 3 root /root/Film_Flex_Release/scripts/deployment/enhanced-cron-wrapper.sh targeted-new >/dev/null 2>&1

# 6. Fallback emergency import - If regular imports consistently fail
0 22 * * * root if [ -f /tmp/import_failed_count ] && [ "$(cat /tmp/import_failed_count)" -gt "3" ]; then /root/Film_Flex_Release/scripts/deployment/enhanced-cron-wrapper.sh fallback force >/dev/null 2>&1; fi

# 7. Daily log cleanup and optimization
0 0 * * * root find /var/log/filmflex -name "*.log" -type f -mtime +30 -delete >/dev/null 2>&1

# 8. Weekly log rotation and backup
0 23 * * 0 root /root/Film_Flex_Release/scripts/maintenance/rotate-logs.sh >/dev/null 2>&1

# 9. Database statistics and health monitoring - Daily at 2 AM  
0 2 * * * root /root/Film_Flex_Release/scripts/maintenance/log-db-stats.sh >/dev/null 2>&1

# 10. Enhanced health check - Every 4 hours with improved diagnostics
0 */4 * * * root /root/Film_Flex_Release/scripts/maintenance/health-check.sh >/dev/null 2>&1

# 11. Import success monitoring - Track import effectiveness
30 6,18 * * 1-5 root /root/Film_Flex_Release/scripts/maintenance/track-import-success.sh >/dev/null 2>&1

# 12. Database optimization - Weekly maintenance
0 3 * * 0 root docker exec filmflex-postgres psql -U filmflex -d filmflex -c "VACUUM ANALYZE;" >/dev/null 2>&1