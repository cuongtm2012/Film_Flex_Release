<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Player Test - FilmFlex</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #3b82f6;
      margin-bottom: 20px;
      font-size: 28px;
    }

    .test-section {
      background: #1e293b;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid #334155;
    }

    .test-section h2 {
      color: #60a5fa;
      margin-bottom: 16px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .player-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .info {
      background: #0f172a;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 12px;
      font-size: 14px;
      line-height: 1.6;
    }

    .info strong {
      color: #60a5fa;
    }

    .log {
      background: #000;
      color: #10b981;
      padding: 16px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 16px;
    }

    .log div {
      margin-bottom: 4px;
    }

    .log .error {
      color: #ef4444;
    }

    .log .warning {
      color: #f59e0b;
    }

    .log .success {
      color: #10b981;
    }

    .log .info {
      color: #3b82f6;
      background: transparent;
      padding: 0;
      margin: 0;
    }

    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-right: 8px;
      transition: background 0.2s;
    }

    button:hover {
      background: #2563eb;
    }

    button:active {
      background: #1d4ed8;
    }

    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .status.loading {
      background: #f59e0b;
      color: #000;
    }

    .status.success {
      background: #10b981;
      color: #000;
    }

    .status.error {
      background: #ef4444;
      color: #fff;
    }

    .controls {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    select {
      background: #0f172a;
      color: #e2e8f0;
      border: 1px solid #334155;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      flex: 1;
      min-width: 200px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .card {
      background: #0f172a;
      padding: 16px;
      border-radius: 6px;
      border: 1px solid #334155;
    }

    .card h3 {
      color: #60a5fa;
      font-size: 16px;
      margin-bottom: 12px;
    }

    .card ul {
      list-style: none;
      font-size: 13px;
      line-height: 1.8;
    }

    .card li {
      padding: 4px 0;
    }

    .card li::before {
      content: "‚úì ";
      color: #10b981;
      font-weight: bold;
      margin-right: 8px;
    }

    .card li.error::before {
      content: "‚úó ";
      color: #ef4444;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      background: #334155;
      color: #94a3b8;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé¨ Video Player Test Suite</h1>

    <!-- Test URLs from PhimAPI -->
    <div class="test-section">
      <h2>
        Test 1: PhimAPI Player
        <span id="status1" class="status loading">LOADING</span>
      </h2>
      <div class="info">
        <strong>URL:</strong> https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250610/ehBaFKT5/index.m3u8
      </div>
      <div class="info">
        <strong>Movie:</strong> Xin ƒê·ª´ng G√°c M√°y (Full)
      </div>
      <div class="player-container">
        <iframe 
          id="player1"
          src="https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250610/ehBaFKT5/index.m3u8"
          allowfullscreen
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        ></iframe>
      </div>
      <div class="controls">
        <button onclick="reloadPlayer('player1', 'status1')">üîÑ Reload Player</button>
        <button onclick="openInNewTab('https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250610/ehBaFKT5/index.m3u8')">üîó Open Direct</button>
        <button onclick="testM3u8('https://s6.kkphimplayer6.com/20250610/ehBaFKT5/index.m3u8')">üìπ Test M3U8</button>
      </div>
    </div>

    <!-- Test Direct M3U8 -->
    <div class="test-section">
      <h2>
        Test 2: Alternative Movie
        <span id="status2" class="status loading">LOADING</span>
      </h2>
      <div class="info">
        <strong>URL:</strong> https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250413/lws7IUgL/index.m3u8
      </div>
      <div class="info">
        <strong>Movie:</strong> Gi√≥ Nam Hi·ªÉu L√≤ng T√¥i (T·∫≠p 01)
      </div>
      <div class="player-container">
        <iframe 
          id="player2"
          src="https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250413/lws7IUgL/index.m3u8"
          allowfullscreen
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        ></iframe>
      </div>
      <div class="controls">
        <button onclick="reloadPlayer('player2', 'status2')">üîÑ Reload Player</button>
        <button onclick="openInNewTab('https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250413/lws7IUgL/index.m3u8')">üîó Open Direct</button>
        <button onclick="testM3u8('https://s5.phim1280.tv/20250413/lws7IUgL/index.m3u8')">üìπ Test M3U8</button>
      </div>
    </div>

    <!-- Diagnostics -->
    <div class="test-section">
      <h2>üîç Diagnostic Information</h2>
      
      <div class="grid">
        <div class="card">
          <h3>Browser Info</h3>
          <ul id="browserInfo"></ul>
        </div>
        
        <div class="card">
          <h3>Network Status</h3>
          <ul id="networkInfo"></ul>
        </div>
        
        <div class="card">
          <h3>CSP Status</h3>
          <ul id="cspInfo"></ul>
        </div>
      </div>

      <div class="log" id="consoleLog">
        <div class="info">Console output will appear here...</div>
      </div>
    </div>
  </div>

  <script>
    // Console logging
    const logContainer = document.getElementById('consoleLog');
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    function addLog(message, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logContainer.appendChild(div);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    console.log = function(...args) {
      originalLog.apply(console, args);
      addLog(args.join(' '), 'success');
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      addLog('ERROR: ' + args.join(' '), 'error');
    };

    console.warn = function(...args) {
      originalWarn.apply(console, args);
      addLog('WARN: ' + args.join(' '), 'warning');
    };

    // Player load tracking
    function setupPlayerTracking(playerId, statusId) {
      const iframe = document.getElementById(playerId);
      const status = document.getElementById(statusId);
      
      iframe.addEventListener('load', () => {
        console.log(`‚úÖ Player ${playerId} loaded successfully`);
        status.textContent = 'SUCCESS';
        status.className = 'status success';
      });

      iframe.addEventListener('error', (e) => {
        console.error(`‚ùå Player ${playerId} failed to load:`, e);
        status.textContent = 'ERROR';
        status.className = 'status error';
      });
    }

    // Reload player
    function reloadPlayer(playerId, statusId) {
      const iframe = document.getElementById(playerId);
      const status = document.getElementById(statusId);
      const currentSrc = iframe.src;
      
      console.log(`üîÑ Reloading ${playerId}...`);
      status.textContent = 'LOADING';
      status.className = 'status loading';
      
      iframe.src = '';
      setTimeout(() => {
        iframe.src = currentSrc;
      }, 100);
    }

    // Open in new tab
    function openInNewTab(url) {
      console.log(`üîó Opening in new tab: ${url}`);
      window.open(url, '_blank');
    }

    // Test M3U8 URL
    function testM3u8(url) {
      console.log(`üìπ Testing M3U8 URL: ${url}`);
      fetch(url, { method: 'HEAD' })
        .then(response => {
          if (response.ok) {
            console.log(`‚úÖ M3U8 URL is accessible (${response.status})`);
            console.log(`   Content-Type: ${response.headers.get('content-type')}`);
          } else {
            console.error(`‚ùå M3U8 URL returned ${response.status}`);
          }
        })
        .catch(error => {
          console.error(`‚ùå M3U8 URL test failed:`, error.message);
          console.warn(`   This might be due to CORS. Try opening the URL directly.`);
        });
    }

    // Browser info
    function updateBrowserInfo() {
      const info = document.getElementById('browserInfo');
      info.innerHTML = `
        <li>User Agent: ${navigator.userAgent.split(' ')[0]}<span class="badge">${navigator.userAgent.split('/').pop()}</span></li>
        <li>Platform: ${navigator.platform}</li>
        <li>Cookies: ${navigator.cookieEnabled ? 'Enabled' : 'Disabled'}</li>
        <li>Online: ${navigator.onLine ? 'Yes' : 'No'}</li>
      `;
    }

    // Network info
    function updateNetworkInfo() {
      const info = document.getElementById('networkInfo');
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      
      if (connection) {
        info.innerHTML = `
          <li>Effective Type: ${connection.effectiveType || 'Unknown'}</li>
          <li>Downlink: ${connection.downlink || 'Unknown'} Mbps</li>
          <li>RTT: ${connection.rtt || 'Unknown'} ms</li>
        `;
      } else {
        info.innerHTML = '<li class="error">Network API not supported</li>';
      }
    }

    // CSP info
    function updateCSPInfo() {
      const info = document.getElementById('cspInfo');
      const csp = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
      
      info.innerHTML = `
        <li>CSP Meta Tag: ${csp ? 'Found' : 'Not Found'}</li>
        <li>Checking via HTTP headers...</li>
      `;

      // Try to detect CSP violations
      window.addEventListener('securitypolicyviolation', (e) => {
        console.error('üö® CSP Violation:', e.violatedDirective, e.blockedURI);
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üé¨ Video Player Test Suite Started');
      console.log('='.repeat(50));
      
      setupPlayerTracking('player1', 'status1');
      setupPlayerTracking('player2', 'status2');
      
      updateBrowserInfo();
      updateNetworkInfo();
      updateCSPInfo();
      
      console.log('‚úÖ Test page initialized');
      console.log('üì∫ Players are now loading...');
    });

    // Monitor network errors
    window.addEventListener('error', (e) => {
      if (e.target.tagName === 'IFRAME') {
        console.error('‚ùå Iframe load error:', e.target.id || e.target.src);
      }
    }, true);
  </script>
</body>
</html>
